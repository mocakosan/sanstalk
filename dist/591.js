"use strict";(self.webpackChunksanstalk=self.webpackChunksanstalk||[]).push([[591],{38591:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(92309),a=n(32545),o=n(15692),l=n(38678),c=n(73046),u=n(83564),i=n(9669),s=n.n(i),f=n(67294),d=n(16550),m=n(96042),h=n(95591);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const v=function(e){var t,n,r=e.show,a=e.onCloseModal,i=e.setShowInviteChannelModal,v=(0,d.UO)(),b=v.workspace,y=v.channel,g=(t=(0,l.Z)(""),n=3,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,l,c=[],u=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){i=!0,a=e}finally{try{if(!u&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(i)throw a}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),w=g[0],k=g[1],C=g[2],S=(0,h.ZP)("/api/users",u.Z).data,E=(0,h.ZP)(S?"/api/workspaces/".concat(b,"/channels/").concat(y,"/members"):null,u.Z).mutate,Z=(0,f.useCallback)((function(e){e.preventDefault(),w&&w.trim()&&s().post("/api/workspaces/".concat(b,"/channels/").concat(y,"/members"),{email:w}).then((function(){E(),i(!1),C("")})).catch((function(e){var t;console.dir(e),m.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[y,w,E,C,i,b]);return f.createElement(o.Z,{show:r,onCloseModal:a},f.createElement("form",{onSubmit:Z},f.createElement(c.__,{id:"member-label"},f.createElement("span",null,"채널 멤버 초대"),f.createElement(c.II,{id:"member",value:w,onChange:k})),f.createElement(c.zx,{type:"submit"},"초대하기")))};var b=n(32951),y=n(64336),g=n(18667),w=n(44593);function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,l,c=[],u=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){i=!0,a=e}finally{try{if(!u&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(i)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const S=function(){var e,t,n=(0,d.UO)(),o=n.workspace,c=n.channel,i=k((0,f.useState)(!1),2),p=i[0],C=i[1],S=k((0,b.Z)(o),1)[0],E=(0,h.ZP)("/api/users",u.Z).data,Z=(0,w.ZP)((function(e){return"/api/workspaces/".concat(o,"/channels/").concat(c,"/chats?perPage=").concat(20,"&page=").concat(e+1)}),u.Z,{onSuccess:function(e){1===(null==e?void 0:e.length)&&setTimeout((function(){var e;null===(e=x.current)||void 0===e||e.scrollToBottom()}),100)}}),A=Z.data,_=Z.mutate,I=Z.setSize,O=(0,h.ZP)(E?"/api/workspaces/".concat(o,"/channels/").concat(c,"/members"):null,u.Z).data,T=(0,h.ZP)("/api/workspaces/".concat(o,"/channels"),u.Z).data,j=null==T?void 0:T.find((function(e){return e.name===c})),M=k((0,l.Z)(""),3),P=M[0],U=M[1],B=M[2],x=(0,f.useRef)(null),z=k((0,f.useState)(!1),2),D=(z[0],z[1],0===(null==A||null===(e=A[0])||void 0===e?void 0:e.length)),N=D||A&&(null===(t=A[A.length-1])||void 0===t?void 0:t.length)<20,R=(0,f.useCallback)((function(e){if(e.preventDefault(),null!=P&&P.trim()&&A&&j){var t=P;_((function(e){var n;return null==e||e[0].unshift({id:((null===(n=A[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:E.id,User:E,ChannelId:j.id,Channel:j,createdAt:new Date}),e}),!1).then((function(){var e;B(""),x.current&&(console.log("scrollToBottom!",null===(e=x.current)||void 0===e?void 0:e.getValues()),x.current.scrollToBottom())})),s().post("/api/workspaces/".concat(o,"/channels/").concat(c,"/chats"),{content:P}).catch(console.error)}}),[P,o,c,E,j,A,_,B]),H=(0,f.useCallback)((function(){C(!0)}),[]),V=(0,f.useCallback)((function(){C(!1)}),[]),$=(0,f.useCallback)((function(e){e.Channel.name===c&&e.UserId!==E.id&&_((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;x.current&&(x.current.getScrollHeight()<x.current.getClientHeight()+x.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(e=x.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=x.current)||void 0===e||e.scrollToBottom()}),100)):m.Am.success("새 메시지가 도착했습니다.",{onClick:function(){var e;null===(e=x.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0}))}))}),[c,E]);if((0,f.useEffect)((function(){return null==S||S.on("message",$),function(){null==S||S.off("message",$)}}),[S,$]),!E||!E)return null;var F=(0,g.Z)(A?A.flat().reverse():[]);return f.createElement(y.W2,null,f.createElement(y.h4,null,f.createElement("span",null,"#",c),f.createElement("div",{className:"header-right"},f.createElement("span",null,null==O?void 0:O.length),f.createElement("button",{onClick:H,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},f.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),f.createElement(a.Z,{scrollbarRef:x,isReachingEnd:N,isEmpty:D,chatSections:F,setSize:I}),f.createElement(r.Z,{onSubmitForm:R,chat:P,onChangeChat:U,placeholder:"Message ".concat(E.nickname),data:[]}),f.createElement(v,{show:p,onCloseModal:V,setShowInviteChannelModal:C}))}}}]);